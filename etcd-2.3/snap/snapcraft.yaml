name: etcd
version: '2.3.8'
summary: Resilient key-value store by CoreOS
description: |
  Etcd is a high availability key-value store, implementing the RAFT
  algorithm to deal with failover within the etcd cluster. Popular
  as a store of small but important data in distributed systems.
confinement: strict
grade: stable
architectures:
  - s390x

apps:
  etcd:
    daemon: simple
    command: snap-wrap.sh
    plugs: [ network-bind, removable-media ]
  etcdctl:
    command: etcdctl
    plugs: [ home, network-bind ]
    aliases:
      - etcdctl

parts:
  etcd:
    plugin: dump
    source: .
    prepare: |
      set -eux

      # This scriptlet assumes that a reasonable version of golang is
      # installed.
      go version
      git clone https://github.com/coreos/etcd.git --branch v2.3.8 --depth 1
      (cd etcd
        export GOOS=linux
        export GOARCH=s390x
        ./build
      )
      mkdir -p bin
      mv etcd/bin/etcd bin
      mv etcd/bin/etcdctl bin
      rm -rf etcd
    stage:
      - bin/etcd
      - bin/etcdctl
  etcd-wrapper:
    plugin: dump
    source: .
    stage:
      - bin/snap-wrap.sh
